<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Twister Roulette</title>
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 10px;
      background: #eee;
      font-family: sans-serif;
    }

    .roulette-container {
      position: relative;
      width: min(450px, 95vw);
      height: min(450px, 95vw);
      max-width: 600px;
      max-height: 600px;
    }

    /* Curseur */
    .cursor {
      width: 0;
      height: 0;
      border-left: clamp(12px, 3vw, 15px) solid transparent;
      border-right: clamp(12px, 3vw, 15px) solid transparent;
      border-top: clamp(20px, 5vw, 25px) solid black;
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
    }
    
    /* Roue extérieure (couleurs) */
    .ring {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(
        #1e87f0 0deg 20deg,
        #fda066 20deg 40deg,
        #a259ff 40deg 60deg,
        #32d296 60deg 80deg,
        #000 80deg 100deg,
        #1e87f0 100deg 120deg,
        #fda066 120deg 140deg,
        #a259ff 140deg 160deg,
        #32d296 160deg 180deg,
        #1e87f0 180deg 200deg,
        #fda066 200deg 220deg,
        #a259ff 220deg 240deg,
        #32d296 240deg 260deg,
        #000 260deg 280deg,
        #1e87f0 280deg 300deg,
        #fda066 300deg 320deg,
        #a259ff 320deg 340deg,
        #32d296 340deg 360deg
      );
      transition: transform 4s ease-out;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Centre blanc */
    .center {
      width: 63%;
      height: 63%;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      justify-content: center;
      align-items: center;
      color: rgba(0,0,0,0.5);
      font-size: clamp(12px, 3.5vw, 16px);
    }

    /* Quadrillage */
    .center::before {
      content: "";
      position: absolute;
      width: 2px;
      height: 100%;
      background: #ccc;
    }

    .center::after {
      content: "";
      position: absolute;
      height: 2px;
      width: 100%;
      background: #ccc;
    }

    /* 4 zones textuelles */
    .zone {
      position: absolute;
      text-align: center;
      width: clamp(70px, 22%, 90px);
      font-size: clamp(10px, 3vw, 14px);
    }

    .left-hand { top: 10%; left: 10%; transform: rotate(-45deg); }
    .right-hand { top: 10%; right: 10%; transform: rotate(45deg); }
    .left-foot { bottom: 10%; left: 10%; transform: rotate(45deg); }
    .right-foot { bottom: 10%; right: 10%; transform: rotate(-45deg); }

    /* Popup */
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 15px 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      display: none;
      z-index: 20;
      text-align: center;
      min-width: min(300px, 90vw);
      max-width: min(400px, 95vw);
      max-height: 90vh;
      overflow-y: auto;
    }

    .popup .color-box {
      width: 30px;
      height: 30px;
      display: inline-block;
      margin-right: 10px;
      vertical-align: middle;
      border-radius: 4px;
    }

    .popup button {
      margin-top: 10px;
      padding: 5px 10px;
      border: none;
      background: #1e87f0;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    .question-content {
      margin-top: 10px;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 4px;
    }

    .question-content .theme {
      font-weight: bold;
      color: #666;
      font-size: clamp(11px, 3vw, 12px);
      margin-bottom: 5px;
    }

    .question-content .question {
      font-size: clamp(13px, 3.5vw, 14px);
      margin: 10px 0;
    }

    .question-content .type {
      font-style: italic;
      color: #999;
      font-size: clamp(10px, 2.8vw, 11px);
    }

    .options-list {
      margin-top: 10px;
      text-align: left;
    }

    .options-list .option {
      padding: 8px 12px;
      margin: 5px 0;
      background: white;
      border: 2px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: clamp(12px, 3.2vw, 13px);
    }

    .options-list .option:hover {
      background: #e8f4ff;
      border-color: #1e87f0;
    }

    .answer-section {
      margin-top: 15px;
      padding: 10px;
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 5px;
      display: none;
    }

    .answer-section.visible {
      display: block;
    }

    .answer-section .answer-label {
      font-weight: bold;
      color: #856404;
      margin-bottom: 5px;
    }

    .answer-section .answer-text {
      color: #856404;
    }

    .show-answer-btn {
      margin-top: 10px;
      padding: 5px 10px;
      border: none;
      background: #ffc107;
      color: #000;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 5px;
    }

    .show-answer-btn:hover {
      background: #ffb300;
    }

    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 19;
    }

    .popup-overlay.visible {
      display: block;
    }

    /* Media queries pour mobile */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      .popup {
        padding: 12px 15px;
      }

      .popup button {
        padding: 8px 12px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="popup-overlay" id="popupOverlay" onclick="closePopup()"></div>
  <div class="roulette-container">
    <div class="cursor"></div>
    <div class="ring" id="roulette">
      <div class="center">
        <div class="zone left-hand">Left Hand</div>
        <div class="zone right-hand">Right Hand</div>
        <div class="zone left-foot">Left Foot</div>
        <div class="zone right-foot">Right Foot</div>
      </div>
    </div>
    <div class="popup" id="popup">
      <span class="close-btn" onclick="closePopup()">×</span><br>
      <span>you landed on</span><br>
      <span class="color-box" id="colorBox"></span>
      <span id="zoneName"></span><br>
      <div class="question-content" id="questionContent">
        <div class="theme" id="questionTheme"></div>
        <div class="question" id="questionText"></div>
        <div class="type" id="questionType"></div>
        <div class="options-list" id="optionsList"></div>
        <div class="answer-section" id="answerSection">
          <div class="answer-label">Answer:</div>
          <div class="answer-text" id="answerText"></div>
        </div>
      </div>
      <button class="show-answer-btn" id="showAnswerBtn" onclick="toggleAnswer()">Show Answer</button>
      <button onclick="closePopup()">Close</button>
    </div>
  </div>

  <script>
    const roulette = document.getElementById("roulette");
    const popup = document.getElementById("popup");
    const colorBox = document.getElementById("colorBox");
    const zoneName = document.getElementById("zoneName");
    const questionTheme = document.getElementById("questionTheme");
    const questionText = document.getElementById("questionText");
    const questionType = document.getElementById("questionType");
    const optionsList = document.getElementById("optionsList");
    const answerSection = document.getElementById("answerSection");
    const answerText = document.getElementById("answerText");
    const showAnswerBtn = document.getElementById("showAnswerBtn");
    const popupOverlay = document.getElementById("popupOverlay");

    // Charger les données de questions
    let questionsData = null;

    // Charger le fichier JSON
    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        questionsData = data;
        console.log('Questions loaded successfully');
      })
      .catch(error => {
        console.error('Error loading questions:', error);
      });

    const segments = [
      { color: '#1e87f0', colorName: 'BLUE' },
      { color: '#fda066', colorName: 'ORANGE' },
      { color: '#a259ff', colorName: 'PURPLE' },
      { color: '#32d296', colorName: 'GREEN' },
      { color: '#000000', colorName: 'BLACK' },
      { color: '#1e87f0', colorName: 'BLUE' },
      { color: '#fda066', colorName: 'ORANGE' },
      { color: '#a259ff', colorName: 'PURPLE' },
      { color: '#32d296', colorName: 'GREEN' },
      { color: '#1e87f0', colorName: 'BLUE' },
      { color: '#fda066', colorName: 'ORANGE' },
      { color: '#a259ff', colorName: 'PURPLE' },
      { color: '#32d296', colorName: 'GREEN' },
      { color: '#000000', colorName: 'BLACK' },
      { color: '#1e87f0', colorName: 'BLUE' },
      { color: '#fda066', colorName: 'ORANGE' },
      { color: '#a259ff', colorName: 'PURPLE' },
      { color: '#32d296', colorName: 'GREEN' }
    ];

    function getZoneFromAngle(angle) {
      if ((angle >= 315 && angle <= 360) || (angle >= 0 && angle < 45)) {
        return 'Right Hand';
      } else if (angle >= 45 && angle < 135) {
        return 'Right Foot';
      } else if (angle >= 135 && angle < 225) {
        return 'Left Foot';
      } else {
        return 'Left Hand';
      }
    }

    function getRandomQuestion(colorName) {
      if (!questionsData) {
        return null;
      }

      let questions = [];
      
      // Mapper les couleurs aux catégories
      switch(colorName) {
        case 'ORANGE':
          questions = questionsData.questions_artificial_intelligence || [];
          break;
        case 'BLUE':
          questions = questionsData.questions_general_knowledge || [];
          break;
        case 'PURPLE':
          questions = questionsData.questions_dangers_internet || [];
          break;
        case 'GREEN':
          questions = questionsData.questions_utility_applications || [];
          break;
        case 'BLACK':
          questions = questionsData.questions_good_luck || [];
          break;
        default:
          questions = questionsData.questions_general_knowledge || [];
      }

      if (questions.length === 0) {
        return null;
      }

      // Sélectionner une question aléatoire
      const randomIndex = Math.floor(Math.random() * questions.length);
      return questions[randomIndex];
    }

    roulette.addEventListener("click", () => {
      const spinDeg = Math.floor(Math.random() * 360) + 360 * (3 + Math.random() * 5);
      roulette.style.transform = `rotate(${spinDeg}deg)`;

      setTimeout(() => {
        let normalizedDeg = (360 - (spinDeg % 360)) % 360;
        const segmentIndex = Math.floor(normalizedDeg / 20) % segments.length;
        const segment = segments[segmentIndex];
        const zone = getZoneFromAngle(normalizedDeg);

        colorBox.style.background = segment.color;
        zoneName.textContent = zone;

        // Récupérer une question aléatoire
        const question = getRandomQuestion(segment.colorName);
        
        console.log('Question:', question); // Debug
        
        if (question && question.theme && question.question) {
          questionTheme.textContent = question.theme;
          questionText.textContent = question.question;
          const difficultyText = question.difficulty ? `Difficulty: ${question.difficulty}` : '';
          questionType.textContent = `Type: ${question.type}${difficultyText ? ' | ' + difficultyText : ''}`;
          
          // Afficher les options si c'est une question à choix multiples
          optionsList.innerHTML = '';
          if (question.options && Array.isArray(question.options) && question.options.length > 0) {
            console.log('Options found:', question.options); // Debug
            question.options.forEach((option, index) => {
              const optionDiv = document.createElement('div');
              optionDiv.className = 'option';
              optionDiv.textContent = `${String.fromCharCode(65 + index)}. ${option}`;
              optionsList.appendChild(optionDiv);
            });
          } else {
            console.log('No options found'); // Debug
          }
          
          // Préparer la réponse (masquée par défaut)
          if (question.answer) {
            answerText.textContent = question.answer;
            answerSection.classList.remove('visible');
            showAnswerBtn.textContent = 'Show Answer';
            showAnswerBtn.style.display = 'inline-block';
          } else {
            showAnswerBtn.style.display = 'none';
            answerSection.classList.remove('visible');
          }
        } else {
          questionTheme.textContent = '';
          questionText.textContent = 'No question available';
          questionType.textContent = '';
          optionsList.innerHTML = '';
          showAnswerBtn.style.display = 'none';
          answerSection.classList.remove('visible');
        }
        
        popup.style.display = "block";
        popupOverlay.classList.add('visible');
      }, 4000);
    });

    function closePopup() {
      popup.style.display = "none";
      popupOverlay.classList.remove('visible');
      answerSection.classList.remove('visible');
      showAnswerBtn.textContent = 'Show Answer';
    }

    function toggleAnswer() {
      if (answerSection.classList.contains('visible')) {
        answerSection.classList.remove('visible');
        showAnswerBtn.textContent = 'Show Answer';
      } else {
        answerSection.classList.add('visible');
        showAnswerBtn.textContent = 'Hide Answer';
      }
    }
  </script>
</body>
</html>
